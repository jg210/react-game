{"version":3,"sources":["redux/actionTypes.js","redux/reducers/debug.js","redux/reducers/level.js","redux/reducers/score.js","redux/reducers/screen.js","redux/reducers/index.js","util/Log.js","redux/sagas/actionLogger.js","redux/actions.js","redux/sagas/gameComplete.js","redux/selectors/index.js","redux/sagas/levelComplete.js","redux/sagas/startLevel.js","redux/sagas/startGame.js","redux/sagas/index.js","redux/store.js","util/Util.js","engine/Magnet.js","engine/GameEngine.js","components/Game.js","components/Level.js","components/Score.js","components/WireframeCheckbox.js","screen/StartLevelScreen.js","screen/StartScreen.js","screen/index.js","screen/GameScreen.js","screen/GameCompleteScreen.js","components/App.js","index.js"],"names":["START_GAME","LEVEL_COMPLETE","GAME_COMPLETE","START_LEVEL","initialState","wireframe","current","last","combineReducers","debug","state","arguments","length","undefined","action","type","Object","objectSpread","payload","enabled","level","Error","concat","score","points","screen","levelStringLengths","map","widestLevel","_","max","Log","classCallCheck","this","createClass","key","value","message","log","now","Date","messageString","console","toISOString","padStart","actionLogger","actionLoggerListener","regenerator_default","a","wrap","_context","prev","next","info","stop","_marked","_context2","takeEvery","_marked2","gameComplete","levelChange","startLevel","screenChange","gameCompleteListener","put","gameComplete_marked","gameComplete_marked2","isLastLevel","createSelector","lastLevel","levelComplete","levelCompleteListener","select","sent","levelComplete_marked","levelComplete_marked2","startLevelListener","call","delay","startLevel_marked","startLevel_marked2","startGame","startGameListener","startGame_marked","startGame_marked2","sagas","storeFactory","sagaMiddleware","createSagaMiddleware","store","createStore","rootReducer","applyMiddleware","forEach","saga","run","Util","min","Magnet","args","constraints","acceleration","speed","dragging","x","y","minX","maxX","width","height","world","maxAcceleration","maxSpeed","peakHeight","vertices","body","Bodies","fromVertices","label","isStatic","render","fillStyle","position","World","add","other","constraint","Constraint","create","bodyA","bodyB","visible","push","event","buttons","rect","clientX","clientY","left","right","top","bottom","canvasRect","isPrimary","button","insideRect","setEnabled","leftButtonPressed","Bounds","contains","bounds","Body","setPosition","dt","clamp","dx","remove","GameEngine","container","scoreUpdate","_this","ballImageSize","magnetHeight","magnetWidth","maxSpeedSquared","Math","pow","maxAngularVelocity","wallThickness","lastUpdateTimestamp","started","stopped","_handleCollision","that","pairs","pair","Sleeping","set","_dislodgeCheck","_handlePointerEvent","renderer","canvas","getBoundingClientRect","magnet","handlePointerEvent","_handleKeyPress","repeat","toggle","_handleBeforeUpdate","timestamp","update","Composite","allBodies","engine","angularVelocity","setAngularVelocity","velocity","speedSquared","ratio","sqrt","setVelocity","_insideBox","objectIds","has","id","_isEverythingSleepingOrEscaped","objectIdsRemaining","size","bind","boxHeight","clientHeight","boxWidth","clientWidth","Engine","gravity","enableSleeping","ballRadius","ballHeight","ballWidth","_createMagnet","ball","_createBall","walls","_createWalls","objects","_createObjects","object","Set","attachToMagnet","toConsumableArray","addToWorld","Render","element","options","background","setWireframe","Events","on","document","addEventListener","focus","removeEventListener","off","delete","_this2","every","bodies","isSleeping","wallOptions","rectangle","xLimit","_initialX","attachmentPosition","circle","sprite","texture","restitution","frictionAir","frictionStatic","_this3","random","seedrandom","range","i","radius","border","wireframes","showSleeping","showAngleIndicator","allConstraints","Game","_Component","props","possibleConstructorReturn","getPrototypeOf","gameEngine","inherits","getElementById","CONTAINER_ID","getContainer","react_default","createElement","className","tabIndex","nonNull","start","_startEngine","_stopEngine","prevProps","prevState","Component","actionCreators","connect","Level","_getPrototypeOf2","_len","Array","_key","apply","handleClick","target","currentTarget","parseInt","onChange","numberOfLevels","WireframeCheckbox","setWireframeMode","checked","StartScreen","ref","React","createRef","assertThisInitialized","onClick","onKeyPress","_handleClick","asyncToGenerator","mark","_callee","toggleFullscreen","window","orientation","lock","t0","screens","game","components_Score","components_Game","components_Level","components_WireframeCheckbox","StartLevelScreen","component","App","es","src_screen","Fullscreenable","decomp","require","rootElement","ReactDOM","src_components_App"],"mappings":"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","file":"static/js/main.dee4b0d1.chunk.js","sourcesContent":["// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport type { ScreenType } from '../screen';\n\nexport const START_GAME = 'START_GAME';\nexport type StartGameAction = {\n  type: typeof(START_GAME)\n};\n\nexport const LEVEL_COMPLETE = 'LEVEL_COMPLETE';\nexport type LevelCompleteAction = {\n  type: typeof(LEVEL_COMPLETE)\n};\n\nexport const GAME_COMPLETE = 'GAME_COMPLETE';\nexport type GameCompleteAction = {\n  type: typeof(GAME_COMPLETE)\n};\n\nexport const LEVEL_CHANGE = 'LEVEL_CHANGE';\nexport type LevelChangeAction = {\n  type: typeof(LEVEL_CHANGE),\n  payload: { level: number }\n};\n\nexport const START_LEVEL = 'START_LEVEL';\nexport type StartLevelAction = {\n  type: typeof(START_LEVEL)\n};\n\nexport const SCORE_UPDATE = 'SCORE_UPDATE';\nexport type ScoreUpdateAction = {\n  type: typeof(SCORE_UPDATE),\n  payload: { points: number }\n};\n\nexport const SCREEN_CHANGE = 'SCREEN_CHANGE';\nexport type ScreenChangeAction = {\n  type: typeof(SCREEN_CHANGE),\n  payload: { screen: ScreenType }\n};\n\nexport const SET_WIREFRAME_MODE = 'SET_WIREFRAME_MODE';\nexport type SetWireframeModeAction = {\n  type: typeof(SET_WIREFRAME_MODE),\n  payload: { enabled: boolean }\n};\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\n\nimport { Action } from 'redux';\nimport { SET_WIREFRAME_MODE } from '../actionTypes';\n\nexport type DebugState = {\n  +wireframe: boolean\n}\n\nconst initialState: DebugState = {\n  wireframe: false\n}\n\nexport const debug = (state: DebugState = initialState, action: Action): DebugState => {\n  switch (action.type) {\n    case SET_WIREFRAME_MODE: {\n      return {...state, wireframe: action.payload.enabled};\n    }\n    default: {\n      return state;\n    }\n  }\n};\n\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport { Action } from 'redux';\nimport { LEVEL_CHANGE } from '../actionTypes';\n\nexport type LevelState = {\n  +current: number,\n  +last: number\n}\n\nconst initialState: LevelState = {\n  current: 1,\n  last: 5\n}\n\nexport const level = (state: LevelState = initialState, action: Action): LevelState => {\n  switch (action.type) {\n    case LEVEL_CHANGE: {\n      let level: number = action.payload.level;\n      if (level === null) {\n        level = state.current + 1;\n      }\n      if (level < 1 || level > state.last) {\n        throw new Error(`level out of range: ${level}`);\n      }\n      return {...state, current: level};\n    }\n    default: {\n      return state;\n    }\n  }\n};\n\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport { Action } from 'redux';\nimport { SCORE_UPDATE } from '../actionTypes';\n\nexport type ScoreState = {\n  +current: number\n}\n\nconst initialState: ScoreState = {\n  current: 0\n}\n\nexport const score = (state: ScoreState = initialState, action: Action): ScoreState => {\n  let { current } = state;\n  switch (action.type) {\n    case SCORE_UPDATE: {\n      const points: number = action.payload.points;\n      current += points;\n      return {...state, current};\n    }\n    default: {\n      return state;\n    }\n  }\n};\n\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport { Action } from 'redux';\nimport { SCREEN_CHANGE } from '../actionTypes';\nimport type { ScreenType } from '../../screen';\n\nexport type ScreenState = {\n  +current: ScreenType\n}\n\nconst initialState: ScreenState = {\n  current: \"start\",\n}\n\nexport const screen = (state: ScreenState = initialState, action: Action): ScreenState => {\n  switch (action.type) {\n    case SCREEN_CHANGE: {\n      const current: ScreenType = action.payload.screen;\n      return {...state, current};\n    }\n    default: {\n      return state;\n    }\n  }\n};\n\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport { combineReducers } from \"redux\";\n\nimport { debug } from \"./debug\";\nimport { level } from \"./level\";\nimport { score } from \"./score\";\nimport { screen } from \"./screen\";\n\nexport default combineReducers({\n  debug,\n  level,\n  score,\n  screen\n});","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport _ from 'lodash';\n\ntype Message = string | () => string;\n\ntype Level = 'INFO' | 'DEBUG';\n\nconst levels: Level[] = ['INFO', 'DEBUG'];\n\nconst levelStringLengths: number[] = levels.map(\n  (level: Level) => level.length\n);\n\nconst widestLevel: number = _.max(levelStringLengths);\n\nexport class Log {\n\n  static info(message: Message) {\n    this.log('INFO', message);\n  }\n\n  static debug(message: Message) {\n    this.log('DEBUG', message);\n  }\n\n  static log(level: Level, message: Message) {\n    // If implement log-level setting, only evaluate function and timestamp if need to.\n    const now = new Date();\n    const messageString: string = (typeof message === 'function') ? message() : message;\n    console.log(`${now.toISOString()} ${level.padStart(widestLevel)} ${messageString}`)\n  }\n\n}\n\n\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport { takeEvery } from 'redux-saga/effects';\n\nimport type { Action } from 'redux';\n\nimport { Log } from '../../util/Log';\n\n// eslint-disable-next-line require-yield\nexport function* actionLogger(action: Action): Generator<*,*,*> {\n  Log.info(`Action: ${action.type}`);\n}\n\nexport function* actionLoggerListener(): Generator<*,*,*> {\n  yield takeEvery(\"*\", actionLogger);\n}\n\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport {\n  GAME_COMPLETE,\n  LEVEL_COMPLETE,\n  LEVEL_CHANGE,\n  START_LEVEL,\n  SCORE_UPDATE,\n  SCREEN_CHANGE,\n  SET_WIREFRAME_MODE,\n  START_GAME\n} from './actionTypes'\nimport type { ScreenType } from '../screen';\n\nexport const startGame = () => ({\n  type: START_GAME\n});\n\nexport const gameComplete = () => ({\n  type: GAME_COMPLETE\n});\n\nexport const levelComplete = () => ({\n  type: LEVEL_COMPLETE\n});\n\nexport const levelChange = (level: ?number = null) => ({\n  type: LEVEL_CHANGE,\n  payload: {\n    level: level\n  }\n});\n\nexport const startLevel = () => ({\n  type: START_LEVEL\n});\n\nexport const scoreUpdate = (points: number) => ({\n  type: SCORE_UPDATE,\n  payload: {\n    points: points\n  }\n});\n\nexport const setWireframeMode = (enabled: boolean) => ({\n  type: SET_WIREFRAME_MODE,\n  payload: {\n    enabled\n  }\n});\n\nexport const screenChange = (screen: ScreenType) => ({\n  type: SCREEN_CHANGE,\n  payload: {\n    screen: screen\n  }\n});\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport { put, takeEvery } from 'redux-saga/effects';\n\nimport { GAME_COMPLETE } from '../actionTypes';\nimport { screenChange } from '../actions';\n\nexport function* gameComplete(): Generator<*,*,*> {\n  yield put(screenChange(\"gameComplete\"));\n}\n\nexport function* gameCompleteListener(): Generator<*,*,*> {\n  yield takeEvery(GAME_COMPLETE, gameComplete);\n}\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport { createSelector } from 'reselect'\n\nimport { type LevelState } from '../reducers/level';\n\ntype State = { level: LevelState }\n\nconst getLevel = (state: State) => state.level.current;\nconst getLastLevel = (state: State) => state.level.last;\n\nexport const isLastLevel = createSelector(\n  [getLevel, getLastLevel],\n  (level: number, lastLevel: number) => {\n    return level === lastLevel;\n  }\n)","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport { put, select, takeEvery } from 'redux-saga/effects';\n\nimport { LEVEL_COMPLETE } from '../actionTypes';\nimport { levelChange, startLevel, gameComplete } from '../actions';\nimport { isLastLevel } from '../selectors';\n\nexport function* levelComplete(): Generator<*,*,*> {\n  if (yield select(isLastLevel)) {\n    yield put(gameComplete());\n  } else {\n    yield put(levelChange());\n    yield put(startLevel());\n  }\n}\n\nexport function* levelCompleteListener(): Generator<*,*,*> {\n  yield takeEvery(LEVEL_COMPLETE, levelComplete);\n}\n\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport { call, put, takeEvery } from 'redux-saga/effects';\nimport { delay } from 'redux-saga'\n\nimport { START_LEVEL } from '../actionTypes';\nimport { screenChange } from '../actions';\n\nexport function* startLevel(): Generator<*,*,*> {\n  yield put(screenChange(\"startLevel\"));\n  yield call(delay, 2500);\n  yield put(screenChange(\"game\"));\n}\n\nexport function* startLevelListener(): Generator<*,*,*> {\n  yield takeEvery(START_LEVEL, startLevel);\n}\n\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport { put, takeEvery } from 'redux-saga/effects';\n\nimport { START_GAME } from '../actionTypes';\nimport { startLevel } from '../actions';\n\nexport function* startGame(): Generator<*,*,*> {\n  yield put(startLevel());\n}\n\nexport function* startGameListener(): Generator<*,*,*> {\n  yield takeEvery(START_GAME, startGame);\n}\n\n\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport { actionLoggerListener } from './actionLogger';\nimport { gameCompleteListener } from './gameComplete';\nimport { levelCompleteListener } from './levelComplete';\nimport { startLevelListener } from './startLevel';\nimport { startGameListener } from './startGame';\n\nexport default [\n  actionLoggerListener,\n  gameCompleteListener,\n  levelCompleteListener,\n  startLevelListener,\n  startGameListener\n];","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport { createStore, applyMiddleware } from 'redux'\nimport createSagaMiddleware from 'redux-saga'\nimport rootReducer from \"./reducers\";\nimport sagas from './sagas';\n\nexport const storeFactory = () => {\n  const sagaMiddleware = createSagaMiddleware();\n  const store = createStore(\n    rootReducer,\n    applyMiddleware(sagaMiddleware)\n  );\n  // $FlowFixMe - problem with Generator type parameters.\n  sagas.forEach((saga: Generator<*,*,*>) => {\n    sagaMiddleware.run(saga);\n  });\n  return store;\n};\n\n\n\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nexport class Util {\n\n  // Clamp value to be within the range [min, max].\n  static clamp(value: number, min: number, max: number): number {\n    if (max < min) {\n      throw new Error(`max of ${max} is less than min ${min} (with value of ${value})`);\n    }\n    if (value < min) {\n      value = min;\n    }\n    if (value > max) {\n      value = max;\n    }\n    return value;\n  }\n\n  // Asserts that a maybe-typed value is not null or undefined.\n  static nonNull<T>(value: ?T): T {\n    if (value === null) {\n      throw new Error(\"null value.\");\n    }\n    if (value === undefined) {\n      throw new Error(\"undefined value.\");\n    }\n    return value;\n  }\n\n}","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport {\n  Body,\n  Bodies,\n  Bounds,\n  Constraint,\n  World\n} from 'matter-js'\n\nimport { Util } from '../util/Util';\n\ntype Args = {\n  +x: number,\n  +y: number,\n  +minX: number,\n  +maxX: number,\n  +width: number,\n  +height: number,\n  +world: World,\n  +maxAcceleration?: number,\n  +maxSpeed?: number\n}\n\ntype Rect = {\n  left: number,\n  top: number,\n  right: number,\n  bottom: number\n};\n\nexport class Magnet {\n\n  +body: Body;\n  +constraints: Constraint[] = [];\n  +height: number;\n  +width: number;\n  +maxAcceleration: number;\n  +maxSpeed: number;\n  +minX: number;\n  +maxX: number;\n  +world: World;\n\n  acceleration: number = 0;\n  enabled: boolean = true;\n  speed: number = 0;\n  dragging: boolean = false;\n\n  constructor(args: Args) {\n    const x = args.x;\n    const y = args.y;\n    this.minX = args.minX;\n    this.maxX = args.maxX;\n    this.width = args.width;\n    this.height = args.height;\n    this.world = args.world;\n    this.maxAcceleration = (args.maxAcceleration === undefined) ? 0.005 : args.maxAcceleration;\n    this.maxSpeed = (args.maxSpeed === undefined) ? 1.3 : args.maxSpeed;\n    const peakHeight = this.height * 0.2;\n    const vertices = [\n      { x: -this.width / 2, y: - this.height / 2 },\n      { x:               0, y: - this.height / 2 - peakHeight },\n      { x:  this.width / 2, y: - this.height / 2 },\n      { x:  this.width / 2, y:   this.height / 2},\n      { x: -this.width / 2, y:   this.height / 2}\n    ];\n    this.body = Bodies.fromVertices(x, y, vertices, {\n      label: \"magnet\",\n      isStatic: true,\n      render: {\n        fillStyle: 'Grey'\n      }\n    });\n  }\n\n  // Bottom centre coordinates of magnet.\n  attachmentPosition() {\n    return { x: this.body.position.x, y: this.body.position.y + this.height / 2 };\n  }\n\n  // Register the Magnet's matter.js Body with the matter.js World.\n  addToWorld() {\n    World.add(this.world, this.body);\n  }\n\n  // Connect another Body to the Magnet.\n  attachToMagnet(other: Body) {\n    const constraint: Constraint = Constraint.create({\n      bodyA: this.body,\n      bodyB: other,\n      render: {\n        visible: false\n      }\n    })\n    this.constraints.push(constraint);\n    if (this.enabled) {\n      World.add(this.world, constraint);\n    }\n  }\n\n  leftButtonPressed(event: PointerEvent) {\n    return event.buttons & 1;\n  }\n\n  insideRect(event: PointerEvent, rect: Rect) {\n    const x = event.clientX;\n    const y = event.clientY;\n    return !(x < rect.left || x > rect.right || y < rect.top || y > rect.bottom);\n  }\n\n  handlePointerEvent(\n    canvasRect: Rect,\n    event: PointerEvent) {\n    if (!event.isPrimary) {\n      // If multiple contact points are possible, ignore all but the primary\n      // (the first one for touch screens). Otherwise, magnet jumps between\n      // each contact point as events are received.\n      return;\n    }\n    if (this.dragging && event.button === 0 && event.type === 'pointerup' && this.insideRect(event, canvasRect)) {\n      // Ignoring pointerup event if it's outside the box means there's a way to\n      // change your mind about releasing the ball after start moving it.\n      this.setEnabled(false);\n    }\n    if (!this.leftButtonPressed(event)) {\n      this.dragging = false;\n      return;\n    }\n    const position = {\n      x: event.clientX - canvasRect.left,\n      y: event.clientY - canvasRect.top\n    };\n    const onMagnet = Bounds.contains(this.body.bounds, position);\n    if (onMagnet) {\n      this.dragging = true;\n      if (event.button === 0 && event.type === 'pointerdown') {\n        this.setEnabled(true);\n      }\n    }\n    if (this.dragging) {\n      this.stop();\n      Body.setPosition(this.body, { x: position.x, y: this.body.position.y});\n    }\n  }\n\n  // Start movement to left.\n  left() {\n    if (this.speed > 0) {\n      this.speed = 0;\n    }\n    this.acceleration = -this.maxAcceleration;\n  }\n\n  // Start movement to right.\n  right() {\n    if (this.speed < 0) {\n      this.speed = 0;\n    }\n    this.acceleration = this.maxAcceleration;\n  }\n\n  // Stop movement.\n  stop() {\n    this.acceleration = 0;\n    this.speed = 0;\n  }\n\n  // Handle matter.js update callback.\n  //\n  // dt - time since last update\n  update(dt: number) {\n    this.speed = Util.clamp(\n      this.speed + this.acceleration * dt,\n      -this.maxSpeed, this.maxSpeed);\n    const dx = this.speed * dt;\n    const x = Util.clamp(\n      this.body.position.x + dx,\n      this.minX, this.maxX);\n    const y = this.body.position.y;\n    Body.setPosition(this.body, { x, y });\n  }\n\n  // Turn the magnet on or off.\n  toggle() {\n    this.setEnabled(!this.enabled);\n  }\n\n  // Turn the magnet on or off.\n  setEnabled(enabled: boolean) {\n    if (enabled) {\n      if (!this.enabled) {\n        World.add(this.world, this.constraints);\n      }\n    } else {\n      if (this.enabled) {\n        World.remove(this.world, this.constraints);\n      }\n    }\n    this.enabled = enabled;\n  }\n\n  // For testing.\n  getSpeed(): number {\n    return this.speed;\n  }\n\n}","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport {\n  Bodies,\n  Body,\n  Composite,\n  Engine,\n  Events,\n  Pair,\n  Render,\n  Sleeping,\n  World\n} from 'matter-js'\nimport _ from 'lodash';\nimport seedrandom from 'seedrandom';\n\nimport { Log } from '../util/Log';\nimport { Magnet } from './Magnet';\nimport { Util } from '../util/Util';\n\nexport class GameEngine {\n\n  +ball: Body;\n  +ballImageSize: number = 64; // pixels\n  +ballRadius: number;\n  +ballHeight: number;\n  +ballWidth: number;\n  +boxHeight: number;\n  +boxWidth: number;\n  +container: HTMLElement;\n  +engine: Engine;\n  +level: number;\n  +magnet: Magnet;\n  +magnetHeight: number = 15;\n  +magnetWidth: number = 50;\n  +maxSpeedSquared: number = Math.pow(7, 2);\n  +maxAngularVelocity: number = 0.5;\n  +levelComplete: () => void;\n  // The ids of all the \"objects\".\n  +objectIds: Set<number>;\n  // The ids of the \"objects\" that have not yet been dislodged.\n  +objectIdsRemaining: Set<number>;\n  +renderer: Render;\n  +scoreUpdate: (points: number) => void;\n  +walls: Body[];\n  +wallThickness: number = 50;\n\n  lastUpdateTimestamp: ?number = null;\n  started: boolean = false;\n  stopped: boolean = false;\n  wireframe: boolean;\n\n  constructor(\n    container: HTMLElement,\n    level: number,\n    wireframe: boolean,\n    levelComplete: () => void,\n    scoreUpdate: (points: number) => void) {\n    \n    this._dislodgeCheck = this._dislodgeCheck.bind(this);\n\n    this.levelComplete = levelComplete;\n    this.scoreUpdate = scoreUpdate;\n    this.level = level;\n    this.wireframe = wireframe;\n    this.container = container;\n    this.boxHeight = container.clientHeight;\n    this.boxWidth = container.clientWidth;\n    this.engine = Engine.create();\n    this.engine.world.gravity.y = 0.2;\n    this.engine.enableSleeping = true;\n    this.ballRadius = 1.025 * this.ballImageSize / 2.0\n    this.ballHeight = this.ballRadius;\n    this.ballWidth = this.ballRadius;\n    this.magnet = this._createMagnet();\n    this.ball = this._createBall(this.magnet);\n    const walls = this._createWalls();\n    const objects = this._createObjects();\n    const objectIds = _.map(objects, (object: Body) => {\n      return object.id;\n    });\n    this.objectIds = new Set(objectIds);\n    this.objectIdsRemaining = new Set(objectIds);\n    this.magnet.attachToMagnet(this.ball);\n    World.add(this.engine.world, [\n      ...walls,\n      this.ball,\n      ...objects\n    ]);\n    this.magnet.addToWorld();\n    Log.info('Body ids:');\n    Composite.allBodies(this.engine.world).forEach((body: Body) => {\n      Log.info(`${body.id} - ${body.label}`);\n    });\n    this.renderer = Render.create({\n      element: this.container,\n      engine: this.engine,\n      options: {\n        background: \"#fafafa\",\n        width: this.boxWidth,\n        height: this.boxHeight\n      }\n    });\n    this.setWireframe(this.wireframe);\n  }\n\n  start() {\n    if (this.started) {\n      throw new Error(\"already started.\");\n    }\n    if (this.stopped) {\n      throw new Error(\"cannot restart.\");\n    }\n    Events.on(this.engine, 'collisionStart', this._handleCollision);\n    Events.on(this.engine, 'beforeUpdate', this._handleBeforeUpdate);\n    Engine.run(this.engine);\n    Render.run(this.renderer);\n    document.addEventListener('keydown', this._handleKeyPress);\n    document.addEventListener('keyup', this._handleKeyPress);\n    this.renderer.canvas.addEventListener('pointerdown', this._handlePointerEvent);\n    this.renderer.canvas.addEventListener('pointermove', this._handlePointerEvent);\n    this.renderer.canvas.addEventListener('pointerup', this._handlePointerEvent);\n    // The canvas has the touch-action CSS attribute set, but the pepjs polyfill\n    // needs a DOM attribute instead: https://github.com/jquery/PEP#touch-action\n    this.renderer.canvas[\"touch-action\"] = \"none\";\n    this.container.focus();\n    this.started = true;\n  }\n\n  stop() {\n    if (!this.started) {\n      throw new Error(\"not started.\");\n    }\n    if (this.stopped) {\n      throw new Error(\"already stopped\");\n    }\n    this.renderer.canvas.removeEventListener('pointerup', this._handlePointerEvent);\n    this.renderer.canvas.removeEventListener('pointerdown', this._handlePointerEvent);\n    this.renderer.canvas.removeEventListener('pointermove', this._handlePointerEvent);\n    document.removeEventListener('keydown', this._handleKeyPress);\n    document.removeEventListener('keyup', this._handleKeyPress);\n    Render.stop(this.renderer);\n    Events.off(this.engine, 'collisionStart');\n    Events.off(this.engine, 'beforeUpdate');\n    this.renderer.canvas.remove();\n    this.started = false;\n    this.stopped = true;\n  }\n\n  _handleCollision = (event: (pairs: [Pair]) => void) => {\n    const that = this;\n    const pairs = event.pairs;\n    pairs.forEach((pair: Pair) => {\n      [pair.bodyA, pair.bodyB].forEach((body: Body) => {\n        Sleeping.set(body, false);\n        that._dislodgeCheck(body);\n      });\n    });\n  }\n\n  _dislodgeCheck: (Body => void);\n  _dislodgeCheck(body: Body) {\n    const dislodged = this.objectIdsRemaining.delete(body.id);\n    if (dislodged) {\n      Log.debug(`dislodged: ${body.id}`);\n      const points = 1;\n      this.scoreUpdate(points);\n    }\n  }\n\n  _handlePointerEvent = (event: PointerEvent) => {\n    var rect = this.renderer.canvas.getBoundingClientRect();\n    this.magnet.handlePointerEvent(rect, event);\n  }\n\n  _handleKeyPress = (event: KeyboardEvent) => {\n    if (event.repeat) {\n      return;\n    }\n    if (event.type === \"keydown\" && event.key === \" \") {\n      this.magnet.toggle();\n    }\n    if (event.type === \"keydown\") {\n      if (event.key === 'ArrowLeft') {\n        this.magnet.left();\n      } else if (event.key === 'ArrowRight') {\n        this.magnet.right();\n      }\n    } else if (event.type === \"keyup\") {\n      this.magnet.stop();\n    } else {\n      throw new Error(event);\n    }\n  }\n\n  _handleBeforeUpdate = (event: {timestamp: number}) => {\n    const that = this;\n    if (this.lastUpdateTimestamp === undefined) {\n      throw new Error(); // flow type refinement\n    }\n    if (!(this.lastUpdateTimestamp === null)) {\n      const dt: number = event.timestamp - this.lastUpdateTimestamp;\n      this.magnet.update(dt);\n    }\n    Composite.allBodies(this.engine.world).forEach((body: Body) => {\n      // Speed and angular velocity are clamped to reduce chance\n      // that ball or object can pass through walls.\n      const angularVelocity: number = Util.clamp(body.angularVelocity,\n        -this.maxAngularVelocity, this.maxAngularVelocity);\n      Body.setAngularVelocity(body, angularVelocity);\n      const velocity = body.velocity;\n      const speedSquared = velocity.x * velocity.x + velocity.y * velocity.y;\n      if (speedSquared > this.maxSpeedSquared) {\n        const ratio = Math.sqrt(this.maxSpeedSquared / speedSquared);\n        Body.setVelocity(body, {\n          x: velocity.x * ratio,\n          y: velocity.y * ratio\n        });\n      }\n      // In case an object is fast enough to pass through wall, remove\n      // it. Otherwise, it likely falls forever and the level never completes.\n      if (!that._insideBox(body) && that.objectIds.has(body.id)) {\n        Log.debug(`escaped: ${body.id}`);\n        World.remove(that.engine.world, body);\n        that._dislodgeCheck(body); // Hopefully never required.\n      }\n    });\n    if (this._isEverythingSleepingOrEscaped()) {\n      if (this.objectIdsRemaining.size === 0) {\n        this.levelComplete();\n      } else {\n        this.magnet.setEnabled(true);\n      }\n    }\n    this.lastUpdateTimestamp = event.timestamp;\n  }\n\n  _insideBox(body: Body): boolean {\n    const x: number = body.position.x;\n    const y: number = body.position.y;\n    return !(x < 0 || x > this.boxWidth || y < 0 || y > this.boxHeight);\n  }\n\n  _isEverythingSleepingOrEscaped() {\n    return _.every(this.engine.world.bodies, (body: Body) => {\n      return body.isSleeping || !this._insideBox(body);\n    });\n  }\n\n  _createWalls(): Body[] {\n    const wallOptions = {\n      isStatic: true,\n      render: {\n        fillStyle: 'LightGrey'\n      }\n    };\n    // matter.js does positioning using centre of mass...\n    const wallTop = Bodies.rectangle(this.boxWidth / 2, 0, this.boxWidth, this.wallThickness, { ...wallOptions, label: \"wall - T\" });\n    const wallBottom = Bodies.rectangle(this.boxWidth / 2, this.boxHeight, this.boxWidth, this.wallThickness, { ...wallOptions, label: \"wall - B\" });\n    const wallRight = Bodies.rectangle(this.boxWidth, this.boxHeight / 2, this.wallThickness, this.boxHeight, { ...wallOptions, label: \"wall - R\" });\n    const wallLeft = Bodies.rectangle(0, this.boxHeight / 2, this.wallThickness, this.boxHeight, { ...wallOptions, label: \"wall - L\" });\n    const walls = [wallTop, wallBottom,  wallRight, wallLeft];\n    return walls;\n  }\n\n  // Initial x coordinate of magnet and ball.\n  _initialX(): number {\n    return 0.68 * (this.boxWidth - this.wallThickness / 2) + this.wallThickness / 2\n  }\n\n  _createMagnet(): Magnet {\n    const xLimit = this.wallThickness / 2 +\n      Math.max(this.magnetWidth / 2, this.ballWidth / 2) +\n      0.01 * this.boxWidth;\n    return new Magnet({\n      x: this._initialX(),\n      y: this.wallThickness / 2 + 0.01 * this.boxHeight + this.magnetHeight / 2,\n      minX: xLimit,\n      maxX: this.boxWidth - xLimit,\n      width: this.magnetWidth,\n      height: this.magnetHeight,\n      world: this.engine.world});\n  }\n\n  _createBall(magnet: Magnet): Body {\n    const x = magnet.attachmentPosition().x;\n    const y = magnet.attachmentPosition().y + this.ballRadius;\n    const ball = Bodies.circle(x, y, this.ballRadius, {\n      label: \"ball\",\n      render: {\n        sprite: {\n          texture: 'ball.png'\n        }\n      },\n      restitution: 0.5,\n      // density: 1,\n      frictionAir: 0,\n      frictionStatic: 0,\n    });\n    return ball;\n  }\n\n  _createObjects(): Body[] {\n    const random = seedrandom(this.level + 484726723);\n    const objects = []\n    _.range(0, this.level).forEach((i: number) => {\n      const radius = 10 + random() * 15;\n      const border = this.wallThickness / 2 + radius;\n      const x = border + (random() * (this.boxWidth - 2 * border));\n      const y = border + this.magnetHeight + this.ballHeight + (random() * (this.boxHeight - 2 * border - this.magnetHeight - this.ballHeight));\n      const object = Bodies.circle(x, y, radius, {\n        label: `object ${i}`,\n        isStatic: false,\n        isSleeping: true\n      });\n      objects.push(object);\n    });\n    return objects;\n  }\n\n  setWireframe(enabled: boolean) {\n    this.wireframe = enabled;\n    this.renderer.options.wireframes = enabled;\n    this.renderer.options.showSleeping = enabled;\n    this.renderer.options.showAngleIndicator = enabled;\n  }\n\n  getBodyCount() {\n    return Composite.allBodies(this.engine.world).length;\n  }\n\n  getConstraintCount() {\n    return Composite.allConstraints(this.engine.world).length;\n  }\n\n}\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\n\nimport { GameEngine } from '../engine/GameEngine';\nimport { levelComplete, scoreUpdate } from '../redux/actions';\nimport { type DebugState } from '../redux/reducers/debug'\nimport { type LevelState } from '../redux/reducers/level'\nimport { Util } from '../util/Util';\n\ntype Props = {\n  level: number,\n  wireframe: boolean,\n  levelComplete: () => void,\n  scoreUpdate: (points: number) => void\n}\n\ntype State = {\n}\n\nexport class Game extends Component<Props,State> {\n\n  static CONTAINER_ID = \"matter_js_container\";\n\n  static getContainer(): ?HTMLElement {\n    return document.getElementById(Game.CONTAINER_ID);\n  }\n\n  // Set keyboard focus on the Game component.\n  //\n  // TODO a more elegant way of setting keyboard focus.\n  // ...CONTAINER_ID should have different value for each Game instance.\n  static focus() {\n    const container = Game.getContainer();\n    if (container) {\n      container.focus();\n    }\n  }\n\n  gameEngine: ?GameEngine;\n\n  constructor(props: Props) {\n    super(props);\n    this.gameEngine = null;\n  }\n\n  render() {\n    if (this.gameEngine) {\n      this.gameEngine.setWireframe(this.props.wireframe);\n    }\n    return (\n      // Need tabIndex, otherwise can't get focus and capture key events.\n      <div\n        className=\"Game\"\n        id={Game.CONTAINER_ID}\n        tabIndex=\"0\" />\n    );\n  }\n\n  _startEngine() {\n    const container = Util.nonNull(Game.getContainer());\n    this.gameEngine = new GameEngine(\n      container,\n      this.props.level,\n      this.props.wireframe,\n      this.props.levelComplete,\n      this.props.scoreUpdate);\n    this.gameEngine.start();\n  }\n\n  _stopEngine() {\n    if (this.gameEngine) {\n      this.gameEngine.stop();\n      this.gameEngine = null;\n    }\n  }\n\n  // React lifecycle.\n  componentDidMount() {\n    this._startEngine();\n  }\n\n  // React lifecycle.\n  componentWillUnmount() {\n    this._stopEngine();\n  }\n\n  // React lifecycle.\n  componentDidUpdate(prevProps: Props, prevState: State) {\n    if (this.props.level === prevProps.level) {\n      return;\n    }\n    this._stopEngine();\n    this._startEngine();\n  }\n\n}\n\n// TODO Should LevelState/DebugState etc. include key too?\nconst mapStateToProps = (state: {level: LevelState, debug: DebugState}) => {\n  const level = state.level.current;\n  const wireframe = state.debug.wireframe;\n  return { level, wireframe };\n};\nconst actionCreators = {\n  levelComplete,\n  scoreUpdate\n}\nexport default connect(mapStateToProps, actionCreators)(Game);\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport React, { Component } from 'react';\nimport { connect } from \"react-redux\";\nimport _ from 'lodash';\n\nimport { levelChange } from '../redux/actions';\nimport type { LevelState } from '../redux/reducers/level';\n\ntype Props = {\n  level: number,\n  numberOfLevels: number,\n  levelChange: (number) => void\n}\n\nexport class Level extends Component<Props> {\n\n  render() {\n    return <select value={this.props.level} onChange={this.handleClick}> \n      {_.range(1, this.props.numberOfLevels + 1).map((i: number) =>\n        <option key={i} value={i}>{i}</option>\n      )}\n    </select>;\n  }\n\n  handleClick = (event: SyntheticEvent<HTMLSelectElement>) => {\n    const target: HTMLSelectElement = event.currentTarget;\n    if (target) {\n      const level: number = parseInt(target.value);\n      this.props.levelChange(level);\n    }\n  }\n\n}\n\nconst mapStateToProps = (state: {level: LevelState}) => {\n  const level = state.level.current;\n  const numberOfLevels = state.level.last\n  return { level, numberOfLevels };\n};\nconst actionCreators = {\n  levelChange\n};\nexport default connect(mapStateToProps, actionCreators)(Level);\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport React from 'react';\nimport { connect } from \"react-redux\";\nimport type { ScoreState } from '../redux/reducers/score';\n\ntype Props = {\n  score: number\n}\n\nexport const Score = (props: Props) => {\n  return (\n    <div className=\"Scores\">\n      <div>{props.score}</div>\n    </div>\n  );\n}\n\nconst mapStateToProps = (state: {score: ScoreState}) => {\n  return { score: state.score.current };\n}\n\nexport default connect(mapStateToProps)(Score);","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport React, { Component } from 'react';\nimport { connect } from \"react-redux\";\n\nimport { setWireframeMode } from '../redux/actions';\nimport type { DebugState } from '../redux/reducers/debug';\nimport { Game } from './Game';\n\ntype Props = {\n  enabled: boolean,\n  setWireframeMode: (boolean) => void\n}\n\nexport class WireframeCheckbox extends Component<Props> {\n\n  render() {\n    return (\n      <div>\n        <span>          \n          <input type=\"checkbox\" checked={this.props.enabled} onChange={this.handleClick}/>\n          debug\n        </span>\n      </div>\n    );\n  }\n\n  handleClick = (event: SyntheticEvent<HTMLInputElement>) => {\n    Game.focus();\n    const target: HTMLInputElement = event.currentTarget;\n    this.props.setWireframeMode(target.checked);\n  }\n\n}\n\nconst mapStateToProps = (state: {debug: DebugState}) => {\n  const enabled = state.debug.wireframe;\n  return { enabled };\n};\nconst actionCreators = {\n  setWireframeMode\n};\nexport default connect(mapStateToProps, actionCreators)(WireframeCheckbox);\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport React from 'react';\nimport { connect } from \"react-redux\";\nimport type { LevelState } from '../redux/reducers/level';\n\ntype Props = {\n  level: number\n};\n\nexport const StartLevelScreen = (props: Props) => {\n  return (\n    <div>Level {props.level}</div>\n  );\n};\n\nconst mapStateToProps = (state: {level: LevelState}) => {\n  const level = state.level.current;\n  return { level };\n};\nconst actionCreators = {};\n\nexport default connect(mapStateToProps, actionCreators)(StartLevelScreen);\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport React, { Component } from 'react';\nimport { connect } from \"react-redux\";\n\nimport { startGame } from '../redux/actions';\n\ntype Props = {\n  startGame: () => void,\n  toggleFullscreen: () => void\n};\n\nexport class StartScreen extends Component<Props> {\n\n  // eslint-disable-next-line flowtype/no-weak-types\n  ref: { current: any } = React.createRef();\n\n  constructor(props: Props) {\n    super(props);\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  render() {\n    return (\n      <div\n        ref={this.ref}\n        tabIndex=\"0\"\n        onClick={this.handleClick}\n        onKeyPress={this.handleClick}\n        className=\"StartScreen\">\n        <p>Press any key to start game.</p>\n        <p>Use left and right arrow keys or the mouse to position the magnet.</p>\n        <p>Press space to turn the magnet on or off.</p>\n        <p>You move to the next level when all objects have been dislodged.</p>\n      </div>\n    );\n  }\n\n  handleClick: () => void; // Allows binding in constructor without flow error.\n  async handleClick() {\n    this.props.toggleFullscreen(); // Can only be called from UI event.\n    this.props.startGame();\n    // Avoid resizing the screen while physics engine is running.\n    if (window.screen &&\n      window.screen.orientation &&\n      window.screen.orientation.lock &&\n      window.screen.orientation.type) {\n      // https://w3c.github.io/screen-orientation/\n      try {\n        await window.screen.orientation.lock(window.screen.orientation.type);\n      } catch (e) {\n        // NotSupportedError.\n      }\n    }\n  }\n\n  componentDidMount() {\n    this.ref.current.focus();\n  }\n\n}\n\nconst mapStateToProps = null;\nconst actionCreators = { startGame };\n\nexport default connect(mapStateToProps, actionCreators)(StartScreen);\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport React from 'react';\nimport { connect } from 'react-redux';\n\nimport type { ScreenState } from '../redux/reducers/screen';\nimport GameScreen from './GameScreen';\nimport GameCompleteScreen from './GameCompleteScreen';\nimport StartLevelScreen from './StartLevelScreen';\nimport StartScreen from './StartScreen';\n\nconst screens = {\n  \"game\": GameScreen,\n  \"gameComplete\": GameCompleteScreen,\n  \"startLevel\": StartLevelScreen,\n  \"start\": StartScreen\n}\n\nexport type ScreenType = $Keys<typeof screens>;\n\ntype Props = {\n  +screen: ScreenType,\n  +toggleFullscreen: () => void\n}\n\nconst Screen = (props: Props) => {\n  const component = screens[props.screen];\n  return React.createElement(\n    component,\n    { toggleFullscreen: props.toggleFullscreen },\n    null\n  );\n}\n\nexport const mapStateToProps = (state: {screen: ScreenState}) => {\n  const screen = state.screen.current;\n  return { screen };\n};\nconst actionCreators = {};\nexport default connect(mapStateToProps, actionCreators)(Screen);\n","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport React from 'react';\n\nimport Game from '../components/Game';\nimport Level from '../components/Level';\nimport Score from '../components/Score';\nimport WireframeCheckbox from '../components/WireframeCheckbox';\n\ntype Props = {};\n\nexport default (props: Props) => {\n  return (\n    <div className=\"GameScreen\">\n      <Score />\n      <Game />\n      <Level />\n      <WireframeCheckbox />\n    </div>\n  );\n};","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport React from 'react';\n\ntype Props = {};\n\nexport default (props: Props) => {\n  return (\n    <div>Game Complete</div>\n  );\n};","// @flow\n//\n// (c) 2018-2019 Jeremy Green\n\nimport React, { Component } from 'react';\nimport { Provider } from 'react-redux';\nimport Fullscreenable from 'react-fullscreenable';\n\nimport { storeFactory } from '../redux/store';\nimport './App.css';\nimport Screen from '../screen';\n\ntype Props = {\n  isFullscreen: boolean,\n  toggleFullscreen: () => void\n};\n\ntype State = {\n};\n\nclass App extends Component<Props,State> {\n\n  // eslint-disable-next-line flowtype/no-weak-types\n  store: Object;\n\n  constructor(props: Props) {\n    super(props);\n    this.store = storeFactory();\n  }\n\n  render() {\n    return (\n      <Provider store={this.store}>\n        <div className=\"App\">\n          <header className=\"App-header\">\n            <Screen toggleFullscreen={this.props.toggleFullscreen}/>\n          </header>\n        </div>\n      </Provider>\n    );\n  }\n\n}\n\nexport default Fullscreenable()(App);\n","// @flow\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './components/App';\nimport { Util } from './util/Util'\n\n// https://www.w3.org/TR/pointerevents/ polyfill.\nimport 'pepjs';\n\n// https://github.com/liabru/matter-js/issues/559\nwindow.decomp = require('poly-decomp');\n\nconst rootElement = Util.nonNull(document.getElementById('root'));\nReactDOM.render(<App />, rootElement);\n"],"sourceRoot":""}